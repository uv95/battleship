# Battleship 
## A multiplayer game built with Node.js and WebSockets 

## Features

- Websocket connection
- Handling player, room, ships, and game requests
- Single play with bot
- Websocket params, and all commands and results are displayed in CLI

## List of websocket commands (requests/responses):
- Player
    - Login or create player\
        ```<-```
        ```ts
        {
            type: "reg",
            data:
                {
                    name: <string>,
                    password: <string>,
                },
            id: 0,
        }
        ```
        ```->```
        ```ts
        {
            type: "reg",
            data:
                {
                    name: <string>,
                    index: <number | string>,
                    error: <bool>,
                    errorText: <string>,
                },
            id: 0,
        }
        ```
    - Update winners (for all after every winners table update)\
        ```->```
        ```ts
        {
            type: "update_winners",
            data:
                [
                    {
                        name: <string>,
                        wins: <number>,
                    }
                ],
            id: 0,
        }
        ```
- Room
    - Create new room (create game room and add yourself there)\
        ```<-```
        ```ts
        {
            type: "create_room",
            data: "",
            id: 0,
        }
        ```
    - Add user to room (add youself to somebodys room, then remove the room from available rooms list)\
        ```<-```
        ```ts
        {
            type: "add_user_to_room",
            data:
                {
                    indexRoom: <number | string>,
                },
            id: 0,
        }
        ```
        ```->```
        ```ts
        {
            type: "create_game", //send for both players in the room, after they are connected to the room
            data:
                {
                    idGame: <number | string>,  
                    idPlayer: <number | string>, /* generated by server id for player in the game session, not enemy (unique id for every player) */
                },
            id: 0,
        }
        ```
    - Update room state (send rooms list, where only one player inside)\
        ```->```
        ```ts
        {
            type: "update_room",
            data:
                [
                    {
                        roomId: <number | string>,
                        roomUsers:
                            [
                                {
                                    name: <string>,
                                    index: <number | string>,
                                }
                            ],
                    },
                ],
            id: 0,
        }
        ```
- Ships
    - Add ships to the game board\
        ```<-```
        ```ts
        {
            type: "add_ships",
            data:
                {
                    gameId: <number | string>,
                    ships:
                        [
                            {
                                position: {
                                    x: <number>,
                                    y: <number>,
                                },
                                direction: <boolean>,
                                length: <number>,
                                type: "small"|"medium"|"large"|"huge",
                            }
                        ],
                    indexPlayer: <number | string>, /* id of the player in the current game session */
                },
            id: 0,
        }
        ```        
    - Start game (only after server receives both player's ships positions)\        
        ```->```
        ```ts
        {
            type: "start_game",
            data:
                {
                    ships: /* player's ships, not enemy's */
                        [
                            {
                                position: {
                                    x: <number>,
                                    y: <number>,
                                },
                                direction: <boolean>,
                                length: <number>,
                                type: "small"|"medium"|"large"|"huge",
                            }
                        ],
                    currentPlayerIndex: <number | string>, /* id of the player in the current game session, who have sent his ships */
                },
            id: 0,
        }
        ```  
- Game
    - Attack\
        ```<-```
        ```ts
        {
            type: "attack",
            data:
                {
                    gameId: <number | string>,
                    x: <number>,
                    y: <number>,
                    indexPlayer: <number | string>, /* id of the player in the current game session */
                },
            id: 0,
        }
        ```
    - Attack feedback (should be sent after every shot, miss and after kill sent miss for all cells around ship too)\    
        ```->```
        ```ts
        {
            type: "attack",
            data:
                {
                    position:
                    {
                        x: <number>,
                        y: <number>,
                    },
                    currentPlayer: <number | string>, /* id of the player in the current game session */
                    status: "miss"|"killed"|"shot",
                },
            id: 0,
        }
        ```
    - Random attack\
        ```<-```
        ```ts
        {
            type: "randomAttack",
            data:
                {
                    gameId: <number | string>,
                    indexPlayer: <number | string>, /* id of the player in the current game session */
                },
            id: 0,
        }
        ```
    - Info about player's turn (send after game start and every attack, miss or kill result)\
        ```->```
        ```ts
        {
            type: "turn",
            data:
                {
                    currentPlayer: <number | string>, /* id of the player in the current game session */
                },
            id: 0,
        }
        ```
    - Finish game\
        ```->```
        ```ts
        {
            type: "finish",
            data:
                {
                    winPlayer: <number | string>, /* id of the player in the current game session */
                },
            id: 0,
        }
        ```

## Websocket commands sequence
```
  Player1               Server                  Player2             
    reg         -->                    
                <--        reg     
                <--    update_room    
                <--   update_winners  
 create_room    -->
                <--    update_room    
                                      <--         reg
                           reg        -->
                <--    update_room    -->
                <--   update_winners  -->                       
                                      <--    add_user_to_room
                <--    update_room    -->
                <--    create_game    -->
   add_ships    -->
                                      <--       add_ships
                <--     start_game    -->  
                <--        turn       -->  
 attack (miss)  -->
                <--       attack      -->  
                <--        turn       -->
                                      <--     randomAttack (shoot)
                <--       attack      -->  
                <--        turn       -->
                                      <--     randomAttack (kill) - send state for all cells around killed ship
                <--       attack      -->  
                <--        turn       -->
                <--       attack      -->  
                <--        turn       -->                
                <--       attack      -->  
                <--        turn       -->
                <--       attack      -->  
                <--        turn       -->
                           ...          
                                      <--     randomAttack (miss)
                <--       attack      -->  
                <--        turn       -->    
 attack (miss)  -->
                <--       attack      -->  
                <--        turn       -->
                           ...                            
                <--      finish       -->
                <--   update_winners  -->
```

## Installation
1. Clone/download repo
2. `npm install`
3. If your node version <= 19.0.0 run `nvm install --lts`

## Usage
**Development**

`npm run start:dev`

* Open `http://localhost:8181`

**Production**

`npm run start`

* Open `http://localhost:8181`


